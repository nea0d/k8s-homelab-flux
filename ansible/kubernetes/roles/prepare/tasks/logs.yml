---
- name: upload new logrotate conf template
  template:
    src: 'logrotate.conf.j2'
    dest: '/etc/logrotate.conf'
  become: true # <-- unless you are connecting as root

- name: upload new journald conf template
  template:
    src: 'journald.conf.j2'
    dest: '/etc/systemd/journald.conf'
  become: true # <-- unless you are connecting as root

- name: reload systemd-journald
  systemd:
    name: systemd-journald
    state: restarted
  become: true

- name: upload new rsyslog conf template
  template:
    src: 'rsyslog.conf.j2'
    dest: '/etc/rsyslog.d/50-default.conf'
  become: true # <-- unless you are connecting as root

- name: restart rsyslog service
  ansible.builtin.service:
    name: rsyslog
    state: restarted
  become: true

- name: Check log rotation every 5 minutes
  ansible.builtin.cron:
    name: "rotate logs"
    minute: "*/5"
    hour: "*"
    job: "/usr/sbin/logrotate /etc/logrotate.conf"
  become: true # <-- unless you are connecting as root

- name: Delete log files older than 2 days
  ansible.builtin.cron:
    name: "delete old logs"
    minute: "6"
    hour: "*"
    job: "find /var/log -mindepth 1 -mtime +2 -delete"
  become: true # <-- unless you are connecting as root
